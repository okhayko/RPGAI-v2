
import type { ChangelogEntry } from '../types.ts';

export const CHANGELOG_DATA: ChangelogEntry[] = [
  {
    version: '1.49.1',
    date: '2025-08-31',
    changes: [
      { type: 'feature', text: 'History Compression Threshold Setting - Thêm cài đặt "Ngưỡng nén lịch sử" vào Game Settings Modal với slider 30-200 mục (mặc định 72). User có thể điều chỉnh khi nào auto history compression kích hoạt: thấp hơn = nén sớm hơn, cao hơn = giữ lịch sử lâu hơn.' },
      { type: 'improvement', text: 'Dynamic History Compression Configuration - UnifiedMemoryManager giờ sử dụng historyCompressionThreshold từ gameSettings thay vì hardcoded value. Cả 2 cleanup paths trong GameScreen đều respect user setting, đảm bảo consistent behavior across tất cả memory management operations.' },
      { type: 'fix', text: 'API Settings Modal Height Fix - Sửa lỗi modal quá cao khi thêm nhiều API keys, buttons bị che khuất. Thêm max-height (90vh), scrollable content area, và fixed footer với buttons. Modal giờ responsive và buttons luôn accessible bất kể số lượng API keys.' },
    ],
  },
  {
    version: '1.49.0',
    date: '2025-08-31',
    changes: [
      { type: 'feature', text: 'Chain of Thought (COT) Toggle - Thêm tùy chọn bật/tắt Chain of Thought trong Game Settings. Khi tắt, AI sẽ phản hồi nhanh hơn mà không cần qua trình suy nghĩ chi tiết. Cải thiện performance cho user không muốn xem quá trình reasoning của AI.' },
      { type: 'fix', text: 'COT Response Schema Fix - Sửa lỗi AI vẫn tạo COT reasoning khi COT bị tắt. Thay đổi responseSchema từ static object sang conditional useMemo dựa trên gameSettings.enableCOT. Schema giờ chỉ require "cot_reasoning" field khi COT được bật, đảm bảo AI thực sự không tạo COT khi disabled.' },
      { type: 'improvement', text: 'Concise COT Reasoning Steps - Tối ưu COT prompt để mỗi bước reasoning chỉ dài 15-30 từ thay vì verbose explanations. Thêm explicit instruction "⚠️ QUAN TRỌNG - GIỚI HẠN ĐỘ DÀI: Mỗi bước COT chỉ được 15-30 từ. Viết ngắn gọn, súc tích!" và update example templates cho concise format.' },
      { type: 'improvement', text: 'Floating Choice Panel Positioning Fix - Di chuyển FloatingChoicePanel từ absolute positioning sang fixed positioning để tránh che khuất story text. Panel giờ được định vị relative to viewport (bottom: 0) thay vì container, đảm bảo không overlap với nội dung story.' },
      { type: 'feature', text: 'Enhanced NPC Data Generation & Validation - Thêm comprehensive NPC enhancement system với intelligent field filling: relationship field auto-convert sang tiếng Việt, age inference từ context (Thanh niên/Trung niên/Cao tuổi), detailed appearance generation từ story context, và fallback descriptions. NPC hiện có đầy đủ thông tin trong EntityInfoModal và StatusPanel.' },
      { type: 'improvement', text: 'AI Prompt Enhancement for NPCs - Cải thiện prompt template với "BẮT BUỘC" requirements cho tất cả NPC fields, minimum word counts cho appearance/description (10-15 từ), và explicit Vietnamese relationship values. AI giờ được hướng dẫn chi tiết hơn để generate complete NPC data.' },
      { type: 'feature', text: 'Enhanced Custom Rules Integration - Cải tiến logic custom rules trong generateInitialStory để AI sử dụng cả rules có "Active" VÀ "Always Active" được check (thay vì OR logic). Custom rules giờ tác động mạnh hơn vào câu chuyện khởi đầu với logic AND requirement.' },
      { type: 'feature', text: 'Lore Concept Generation Progress Display - Thêm loreConcepts prop vào InitializationProgress component để hiển thị real-time các lore concepts được tạo ra. Progress bar giờ show count và preview description (60 chars) của generated concepts với scrollable UI.' },
      { type: 'improvement', text: 'Re-enabled Lore Concept Generation - Khôi phục lore concept generation step trong startNewGame function (trước đây bị disable). Game initialization giờ tạo lore concepts từ active custom rules trước khi generate initial story, cung cấp context phong phú hơn cho AI.' },
      { type: 'technical', text: 'React 19 Static Flag Compliance - Sửa React warnings về missing static flags trong MemoizedModals.tsx bằng cách wrap EnhancedCustomRulesModal và MapModal với React.memo() và thêm displayName properties. Cải thiện performance và development experience.' },
      { type: 'technical', text: 'Modal Component Memoization - Refactor EnhancedCustomRulesModal và MapModal từ direct exports sang memoized components với proper TypeScript typing. Thêm displayName cho React DevTools và cải thiện re-render performance.' },
    ],
  },
  {
    version: '1.48.0',
    date: '2025-08-30',
    changes: [
      { type: 'feature', text: 'Mobile NPC Presence Access - Thêm floating button trên mobile UI để truy cập NPC Presence tab. Button màu xanh với icon NPC được đặt phía trên inventory button, mở MobileNPCPresenceModal với slide-up animation và responsive design tối ưu cho điện thoại.' },
      { type: 'feature', text: 'Mobile NPC Presence Modal - Modal chuyên biệt cho mobile hiển thị tất cả NPCs hiện diện với thông tin chi tiết: tên, tuổi, giới tính, ngoại hình, mối quan hệ. Inner thoughts được hiển thị trong collapsible spoiler format với styling màu tím. NPCs mới có badge "Mới" màu vàng.' },
      { type: 'feature', text: 'AI-Powered NPC Auto-Removal System - Implement BƯỚC 3B enhancement trong COT system: "LOẠI BỎ NPCs KHÔNG HOẠT ĐỘNG". AI tự động phân tích 3 lượt gần nhất và loại bỏ NPCs không có dialogue/action, giữ lại NPCs quan trọng cho cốt truyện. Transparent logging trong COT reasoning.' },
      { type: 'improvement', text: 'Enhanced NPC Detection Instructions - COT prompt được cải tiến với QUY TẮC 3 LƯỢT: NPCs bị loại nếu chỉ xuất hiện thụ động (được nhắc đến) mà không tương tác. Có ngoại lệ cho NPCs đang trong conversation hoặc story-critical. AI phải document removed NPCs và lý do trong COT reasoning.' },
      { type: 'fix', text: 'NPC Inner Thoughts Parsing Fix - Sửa lỗi inner thoughts không hiển thị cho existing NPCs (như Tony Tony Chopper). Thay đổi logic từ "skip duplicates" thành "merge inner thoughts" trong StatusPanel.tsx. Existing entity NPCs giờ nhận inner thoughts từ AI response thay vì hiển thị "Không có suy nghĩ nào được tạo."' },
      { type: 'technical', text: 'NPC Presence Modal State Management - Thêm isNPCPresenceModalOpen state vào useModalState hook, cập nhật MemoizedModals interface và rendering logic. GameScreen.tsx truyền đầy đủ props cho mobile functionality. Build system verified error-free.' },
      { type: 'technical', text: 'Cross-Platform NPC Data Consistency - Mobile modal sử dụng inner_thoughts field (underscore format) trực tiếp từ AI response, desktop StatusPanel merge vào innerThoughts field (camelCase). Đảm bảo consistent experience across platforms với proper field mapping.' },
    ],
  },
  {
    version: '1.47.0',
    date: '2025-08-28',
    changes: [
      { type: 'feature', text: 'Enhanced Chain of Thought (COT) System - Triển khai hệ thống COT reasoning hoàn chỉnh với JSON field integration. AI giờ bắt buộc phải cung cấp suy nghĩ từng bước trong field "cot_reasoning" thay vì external tags, tương thích với Gemini API application/json constraints.' },
      { type: 'feature', text: 'COT Research Logging to Save File - Thêm comprehensive logging system lưu trữ AI reasoning patterns vào save file. Mỗi AI response được phân tích và log với turn number, timestamp, user action, COT content, performance metrics, và response quality scores cho research và debugging.' },
      { type: 'feature', text: 'Advanced COT Step for Choice Generation - Bổ sung BƯỚC 4B: "THIẾT KẾ LỰA CHỌN THEO YÊU CẦU" vào COT prompt, yêu cầu AI phân tích systematic cho choice diversity (7-9 categories), asset utilization, story progression, character consistency, và formatting requirements.' },
      { type: 'improvement', text: 'Triple-Layer COT Instructions - Implement 3-tier instruction system: (1) Critical priority instructions tại đầu prompt, (2) Advanced COT reasoning section với detailed steps, (3) Final urgency reminders tại cuối prompt với visual cues (🚨🔥) để đảm bảo AI compliance.' },
      { type: 'improvement', text: 'Real-time COT Monitoring - Console logs hiển thị AI reasoning process real-time với extraction status, content preview, và detection confirmation. Users có thể monitor AI thinking process trong browser console trong khi story panel vẫn clean.' },
      { type: 'technical', text: 'JSON Schema Integration - Response schema được mở rộng với mandatory "cot_reasoning" field, extractCOTReasoning function ưu tiên JSON field detection, và parseApiResponseHandler tự động extract + log COT content từ structured response.' },
      { type: 'technical', text: 'Game State COT Integration - cotResearchLog được thêm vào GameState interface, useGameState hook, và save file structure. Bao gồm setCotResearchLog setter, updateCOTResearchLog callback, và automatic save file inclusion với 100-entry limit để prevent bloat.' },
      { type: 'fix', text: 'PC Location Update in COT - Fixed PC location not updating correctly in Chain of Thought section. Added party synchronization to LORE_PC command processor để ensure location changes via AI tags được reflect trong COT prompt data.' },
    ],
  },
  {
    version: '1.46.1',
    date: '2025-08-26',
    changes: [
      { type: 'feature', text: 'Max Active History Entries Setting - Thêm slider cài đặt "Số lượng lịch sử tối đa" trong GameSettingsModal để người chơi tự điều chỉnh số mục lịch sử được giữ lại trong bộ nhớ hoạt động (50-500 entries, mặc định 100). Slider được đặt dưới checkbox "Tự động nén lịch sử" và kết nối trực tiếp với UnifiedMemoryManager.' },
      { type: 'improvement', text: 'Customizable Memory Management - UnifiedMemoryManager giờ sử dụng cài đặt maxActiveHistoryEntries từ GameSettings thay vì giá trị hardcoded 100. Cho phép người chơi tối ưu hóa hiệu suất game theo nhu cầu: giá trị thấp (50-80) để tiết kiệm memory, giá trị cao (200-500) để giữ context chi tiết hơn.' },
      { type: 'technical', text: 'Settings Integration - Cập nhật GameSettings interface với maxActiveHistoryEntries property, thêm vào DEFAULT_SETTINGS, và hiển thị trong "Cài đặt hiện tại" section. GameScreen.tsx truyền custom cleanup config với user setting tới coordinatedCleanup method thay vì dùng default config.' },
    ],
  },
  {
    version: '1.46.0',
    date: '2025-08-25',
    changes: [
      { type: 'feature', text: 'AI-Response-Only History System - Triển khai hệ thống lịch sử conversation tối ưu hóa với AI-Response-Only approach. Thay vì lưu trữ toàn bộ user prompts (chứa RAG context), chỉ trích xuất story continuity từ AI responses, tiết kiệm 91.7% tokens trong history context (từ 5,090 → 420 tokens).' },
      { type: 'feature', text: 'Dual-Layer History Optimization - Implement tối ưu hóa 2 tầng: (1) Prompt Building Level - buildSmartHistoryContext chỉ xử lý AI responses, tăng lookback từ 1 → 4 entries; (2) Storage Level - gameHistory chỉ lưu essential user actions thay vì full RAG prompts, giảm 94.8% storage per entry.' },
      { type: 'feature', text: 'Enhanced Story Continuity Extraction - Thêm extractStoryContinuity() và extractStateChanges() methods để trích xuất thông tin quan trọng từ AI responses: key story events, game state changes (skills, quests, locations), và essential narrative elements để duy trì story flow mà không cần user prompts.' },
      { type: 'improvement', text: 'Massive Token Budget Liberation - History context giờ chỉ tiêu tốn ~1k tokens thay vì 15k tokens, giải phóng 14k tokens cho entities, custom rules, world info, và context khác. Cho phép tăng cường RAG system và rule activation mà không vượt quá 90k token limit.' },
      { type: 'improvement', text: 'Optimized Save File Performance - Save files giảm từ 30MB+ xuống ~2MB (95% reduction), load/save nhanh hơn đáng kể, memory usage thấp hơn. GameHistory entries từ 1,468 tokens → 77 tokens mỗi user action, overall conversation savings 67.8% cho 10 turns.' },
      { type: 'technical', text: 'gameActionHandlers.ts Storage Separation - Tách riêng API history (full context cho AI quality) và storage history (optimized entries). AI vẫn nhận đầy đủ context khi generate, nhưng gameHistory chỉ lưu "ACTION: [user_action]" format thay vì massive RAG prompts.' },
      { type: 'fix', text: 'NPC Information Reset/Duplication Prevention - Fixed critical issue where AI recreated existing NPCs, causing information loss. LORE_NPC tags now merge with existing entities instead of overwriting, preserving referenceId, skills, và accumulated data. Added anti-duplication warnings trong AI context.' },
      { type: 'fix', text: 'Enhanced Entity Deduplication System - Triển khai intelligent entity merging cho NPCs và locations. System now preserves existing reference IDs, relationships, và character development while allowing AI to update/enhance entity information naturally.' },
      { type: 'improvement', text: 'Anti-Recreation Context Warnings - Thêm "⚠️ THỰC THỂ ĐÃ TỒN TẠI - KHÔNG TẠO LẠI" warnings trong AI prompts với danh sách existing entities. Giúp AI aware về existing characters và sử dụng ENTITY_UPDATE thay vì LORE_NPC cho character development.' },
    ],
  },
  {
    version: '1.45.0',
    date: '2025-08-19',
    changes: [
      { type: 'feature', text: 'Desktop UI Redesign với Combined Story Panel - Thiết kế lại hoàn toàn giao diện desktop với CombinedStoryPanel mới kết hợp story display (60% phía trên) và action choices (40% phía dưới) thành một cửa sổ chính. Layout được tối ưu hóa theo tỷ lệ 60:40 (story:status) để tối đa hóa không gian đọc câu chuyện.' },
      { type: 'feature', text: 'Integrated StatusPanel với Tabbed Interface - Tạo StatusPanel thay thế cho Action Panel với 3 tabs chính: "👤 Nhân vật" (thông tin PC đầy đủ như PlayerCharacterSheet), "🤝 Đồng đội" (party members), và "📋 Nhiệm vụ" (quest tracking). Tích hợp hoàn toàn thông tin character sheet bao gồm stats, appearance, realm, experience, fame, personality, MBTI, motivation, skills, statuses và inventory.' },
      { type: 'feature', text: 'Comprehensive Character Information Display - StatusPanel hiển thị đầy đủ thông tin như original PlayerCharacterSheet: basic info (name, gender, age, location, appearance), enhanced stats (realm với color highlighting, experience với number formatting, fame với color-coded levels), personality traits (external/MBTI/motivation), skills system (learned skills và regular skills), current statuses với duration, và inventory management.' },
      { type: 'improvement', text: 'Streamlined Header Interface - Loại bỏ các buttons PlayerCharacterSheet, Party, và Quests khỏi desktop header và sidebar navigation. Chỉ giữ lại essential controls trong header, tạo interface sạch sẽ hơn với việc truy cập thông tin player được tích hợp vào StatusPanel.' },
      { type: 'improvement', text: 'Preserved Mobile Experience - Giữ nguyên hoàn toàn mobile UI experience với original StoryPanel và ActionPanel layout. Mobile users tiếp tục sử dụng design được yêu thích với functionality đầy đủ, trong khi desktop users được hưởng lợi từ layout mới được tối ưu hóa.' },
      { type: 'improvement', text: 'Responsive Design System - Implement dual-layout system với mobile layout (grid-based với original components) và desktop layout (flexbox-based với combined components). Seamless responsive behavior không có conflicts giữa hai layouts, đảm bảo optimal experience trên mọi device size.' },
      { type: 'technical', text: 'Component Architecture Refactoring - Tạo CombinedStoryPanel component kết hợp StoryPanel và ActionPanel functionality với virtual scrolling, interactive text support, và action handling. StatusPanel component với tabbed interface, comprehensive character display, và proper state management cho character/party/quest information.' },
      { type: 'feature', text: 'Floating Drop-up Choices Panel - Thay thế fixed bottom choices section bằng elegant floating dropdown panel. Choices panel hiện là collapsible drop-up từ bottom với toggle button hiển thị số lượng choices available, smooth animations, và auto-collapse sau khi chọn action. Tối ưu hóa screen real estate cho story content.' },
      { type: 'improvement', text: 'Enhanced Choice Panel Visibility - Cải thiện đáng kể contrast và readability của choice panel với dark slate background (slate-900/95), stronger borders, improved text contrast (text-white), enhanced number badges với shadow effects, và better hover states cho optimal readability.' },
      { type: 'improvement', text: 'Separated Floating Choice Panel - Tách FloatingChoicePanel thành component riêng biệt và đặt ở vị trí tối ưu để không che khuất nội dung story. Panel được positioned outside của story container, đảm bảo text visibility hoàn toàn trong khi vẫn maintain easy access to choices.' },
      { type: 'fix', text: 'Story Panel và Status Panel Scrolling Functionality - Khắc phục hoàn toàn lỗi scrolling bị broken trong cả CombinedStoryPanel và StatusPanel. Fixed CSS constraints bằng cách remove `overflow-hidden`, thêm `min-h-0` cho flex containers, và thay `overflow-hidden` bằng `h-full` để enable proper scroll behavior. Updated container height calculation và layout structure để restore full scrolling functionality.' },
      { type: 'technical', text: 'Enhanced Layout Management - Implement flexbox-based desktop layout với precise 60%/40% proportions thay vì grid system. Mobile layout sử dụng original grid system, desktop layout sử dụng flexbox cho better control over proportions và responsive behavior.' },
    ],
  },
  {
    version: '1.44.0',
    date: '2025-08-17',
    changes: [
      { type: 'feature', text: 'SillyTavern-Compatible Advanced Rule Activation System - Triển khai hoàn chỉnh hệ thống kích hoạt luật dựa trên keyword matching tương thích với SillyTavern World Info. Hỗ trợ primary/secondary keywords, logic operators (AND_ANY, AND_ALL, NOT_ALL, NOT_ANY), priority system, case sensitivity, whole word matching, và phrase keyword support với [brackets] và "quotes".' },
      { type: 'feature', text: 'Enhanced CustomRule Interface với Professional Features - Mở rộng CustomRule với 15+ fields mới: keywords, secondaryKeywords, logic, order, probability, maxActivationsPerTurn, scanDepth, scanPlayerInput/scanAIOutput/scanMemories/scanEntities, tokenWeight, tokenPriority, caseSensitive, matchWholeWords, activationCount, lastActivated, createdAt, và category system.' },
      { type: 'feature', text: 'RuleActivationEngine - Sophisticated Keyword Matching - Core engine xử lý keyword matching với phrase support, context scanning across player input/AI output/memories/entities, probability-based activation, priority ordering, activation frequency limits, và comprehensive debugging system. Hỗ trợ token budget management và overflow protection.' },
      { type: 'feature', text: 'Enhanced CustomRulesModal với Simple/Advanced Modes - UI hoàn toàn mới với Simple Mode (basic editing) và Advanced Mode (full SillyTavern features). Advanced mode bao gồm keyword management, logic selection, priority settings, activation controls, scan targets, token management, và category organization với professional styling.' },
      { type: 'feature', text: 'SillyTavern WorldInfo Import System - Thêm "Import WorldInfo" button trong CustomRulesModal Advanced Mode và CreateWorld menu. Tự động convert SillyTavern WorldInfo entries thành enhanced custom rules với full field mapping: comment→title, content→content, key→keywords, keysecondary→secondaryKeywords, selectiveLogic→logic, order→order, probability→probability, depth→scanDepth, caseSensitive→caseSensitive, matchWholeWords→matchWholeWords, disable→isActive (inverted), group→category.' },
      { type: 'feature', text: 'Phrase Keyword Support với Advanced Parsing - Hỗ trợ phrase keywords với [brackets] và "quotes" format. Keywords như [gọi điện thoại] hoặc "siêu năng lực" được treat as single units. Advanced parsing system with comma separation, quote/bracket handling, và real-time keyword display trong UI.' },
      { type: 'feature', text: 'Professional Rule Management System - Comprehensive rule helpers với createDefaultRule(), validateRule(), sortByPriority(), migrateLegacyRule(), exportRulesToJSON(), importRulesFromJSON(). Category system với display names (⚔️ Chiến đấu, 👥 Xã hội, 🗺️ Khám phá, 🌐 WorldInfo, etc.), rule statistics tracking, và professional workflows.' },
      { type: 'improvement', text: 'Token-Optimized Prompt Building - Tích hợp RuleActivationEngine vào promptBuilder.ts với intelligent rule selection dựa trên context relevance, priority ordering, token budget management, và activation frequency tracking. Chỉ activate rules thực sự relevant để optimize token usage.' },
      { type: 'improvement', text: 'Advanced UI/UX với Glass-Morphism Design - Enhanced CustomRulesModal với gradient backgrounds, glass-morphism effects, responsive design, touch-friendly controls, real-time keyword parsing, live validation feedback, professional color schemes (purple gradients), và mobile optimization.' },
      { type: 'improvement', text: 'Comprehensive Rule Statistics và Analytics - Tracking system cho rule performance: activationCount, lastActivated timestamps, success rates, token consumption, category distribution. Debug console với detailed activation logs, context analysis, và performance metrics.' },
      { type: 'improvement', text: 'Professional Category Organization System - 9 built-in categories với emoji icons và Vietnamese labels: Tổng quát, Chiến đấu, Xã hội, Khám phá, Cốt truyện, Vật phẩm, Kỹ năng, Thế giới, WorldInfo. Category filtering, batch operations, và visual organization trong UI.' },
      { type: 'improvement', text: 'Replaced Character Card Import với WorldInfo Import - Hoàn toàn thay thế character card import functionality trong CreateWorld menu bằng WorldInfo import. Removed tất cả character card related code, updated button text thành "Nhập WorldInfo", và streamlined import workflow cho SillyTavern compatibility.' },
      { type: 'technical', text: 'RuleActivationEngine Architecture - Sophisticated engine với ActivationContext interface, ActivationResult system, checkKeywordMatch() với phrase support, processRules() với priority ordering, token budget tracking, activation frequency management, và comprehensive debugging framework.' },
      { type: 'technical', text: 'Enhanced Type System - Comprehensive TypeScript interfaces: CustomRule, RuleLogic enum, ActivationContext, ActivationResult, WordInfoEntry. Full type safety across rule management, import/export, UI components, và activation engine với strict typing và validation.' },
      { type: 'technical', text: 'Advanced Import/Export System - Professional data handling với validation, error recovery, ID conflict resolution, backward compatibility với legacy formats, metadata preservation, version tracking, và comprehensive error reporting. Support cho both RPG AI Simulator formats và SillyTavern WorldInfo format.' },
      { type: 'technical', text: 'Optimized Performance Architecture - Efficient keyword matching algorithms, memoized context processing, debounced UI updates, intelligent re-rendering, memory-optimized rule storage, và batch processing capabilities. Designed để handle large rule sets (100+ rules) without performance degradation.' },
      { type: 'fix', text: 'Rule Import Error Handling - Comprehensive error handling cho malformed files, invalid JSON, missing fields, type mismatches, và network issues. User-friendly error messages, partial import support, và automatic data cleanup to prevent crashes.' },
      { type: 'fix', text: 'Keyword Input Improvements - Fixed spacebar và comma input issues trong keyword fields. Enhanced input handling với proper state management, real-time parsing, cursor position preservation, và IME compatibility cho Vietnamese input.' },
    ],
  },
  {
    version: '1.43.0',
    date: '2025-08-12',
    changes: [
      { type: 'feature', text: 'SillyTavern-Compatible Regex System - Thêm hệ thống regex processing mạnh mẽ tương thích với SillyTavern. Hỗ trợ placement-based rule execution (Player Input, AI Output, Memory Processing), macro substitution ({{char}}, {{user}}, {{turn}}), và find/replace operations với regex hoặc literal strings. Accessible qua "🔧 Regex Manager" trong Game dropdown (desktop) hoặc sidebar menu (mobile).' },
      { type: 'feature', text: 'Regex Manager với Live Preview System - Interface quản lý regex rules hoàn chỉnh với: rule editor có syntax highlighting, live preview testing, placement selection (Player Input/AI Output/Memory), substitute mode options (Replace/Append/Prepend), macro system, và default RPG templates. Import/export functionality cho rule sharing và backup.' },
      { type: 'feature', text: 'Advanced Regex Processing Engine - Core engine thực thi rules theo placement points: xử lý player input trước khi gửi AI, modify AI output trước display, và process memory content khi storage. Hỗ trợ macro substitution với real-time values, error handling, và performance optimization cho large rule sets.' },
      { type: 'feature', text: 'RPG-Optimized Default Templates - Cung cấp sẵn templates cho common RPG scenarios: combat text enhancement, dialogue formatting, stat display optimization, action text transformation, character name normalization, và immersive text processing. Ready-to-use templates accelerate setup cho RPG game masters.' },
      { type: 'improvement', text: 'Cross-Platform Regex Access - Regex Manager accessible từ cả desktop interface (Game dropdown → "🔧 Regex Manager") và mobile interface (sidebar menu). Consistent UI/UX across all devices với responsive design, touch-friendly controls, và proper modal management.' },
      { type: 'improvement', text: 'Comprehensive Error Handling và Crash Protection - Robust error boundaries protect against regex parsing errors, malformed rules, và runtime exceptions. Defensive programming với null checks, type validation, optional props, và graceful fallbacks ensure system stability. Backwards compatibility với existing save files.' },
      { type: 'fix', text: 'Desktop UI Missing Regex Manager Button - Fixed missing "Regex Manager" button trong desktop interface Game dropdown. Added onRegexManager prop to DesktopHeader component, connected handler từ GameScreen, và ensured consistent access across desktop và mobile platforms.' },
      { type: 'fix', text: 'ReferenceError handleSaveRegexRules Fix - Resolved critical "handleSaveRegexRules is not defined" error trong MemoizedModals component. Added missing prop destructuring, implemented defensive function với try-catch blocks, và ensured proper prop passing từ GameScreen to MemoizedModals.' },
      { type: 'technical', text: 'RegexEngine Architecture - Built comprehensive regex processing engine với placement-based execution logic, macro substitution system, rule priority handling, performance optimization, và extensive error handling. Supports complex regex patterns, literal string replacement, và dynamic content injection.' },
      { type: 'technical', text: 'Type Safety và State Management - Enhanced TypeScript interfaces cho RegexRule, RegexPlacement, RegexSubstituteMode với comprehensive prop interfaces. Integrated regex state vào useGameState hook, useModalState management, và persistent save/load functionality với migration support.' },
    ],
  },
  {
    version: '1.42.0',
    date: '2025-08-12',
    changes: [
      { type: 'feature', text: 'SillyTavern Character Card Import System - Thêm tính năng import character card từ SillyTavern với button "Tải Character Card" riêng biệt. Tự động trích xuất nội dung từ character_book.entries và chuyển đổi thành custom rules. Hỗ trợ cả CreateWorld component và CustomRulesModal với validation format và error handling.' },
      { type: 'fix', text: 'Khắc phục lỗi Auto Memory Cleanup ngừng hoạt động sau load save hoặc API errors - Sửa useEffect dependency array thiếu gameSettings và state variables quan trọng. Enhanced hasGeneratedInitialStory initialization từ gameHistory.length thay vì luôn false. Thêm comprehensive logging để debug cleanup triggers và blocks.' },
      { type: 'improvement', text: 'Enhanced Custom Rules Import với dual format support - Giữ nguyên chức năng import JSON rules truyền thống, thêm Character Card import riêng biệt với indigo color scheme. Smart content extraction từ character_book entries, unique ID generation, và success notifications hiển thị số lượng rules imported.' },
      { type: 'improvement', text: 'Advanced Auto Cleanup Debug System - Thêm detailed logging cho cleanup blocking conditions với specific reasons (turnCount=0, no_initial_story, is_loading, empty_history, turn_already_cleaned). Enhanced cleanup trigger logging với memory/history counts và settings status.' },
      { type: 'technical', text: 'Character Card Parser Implementation - Validates SillyTavern character card structure (data.character_book.entries), extracts content fields, filters empty entries, generates unique rule IDs với character-card prefix, và handles ID conflicts với existing rules.' },
      { type: 'technical', text: 'Auto Cleanup Effect Dependency Optimization - Expanded useEffect dependencies từ [turnCount] thành comprehensive array bao gồm gameSettings, hasGeneratedInitialStory, memories, gameHistory, cleanupStats, và tất cả memory-related state để ensure proper reinitialization.' },
    ],
  },
  {
    version: '1.41.0',
    date: '2025-08-11',
    changes: [
      { type: 'feature', text: 'Triển khai Unified Edit System hoàn chỉnh cho tất cả Entity types - Người chơi giờ có thể chỉnh sửa trực tiếp thông tin của Skills, NPCs, PCs, và Locations thông qua các edit modals chuyên dụng với giao diện thân thiện và validation system.' },
      { type: 'feature', text: 'EditSkillModal với mastery dropdown system - Hỗ trợ chỉnh sửa tất cả thuộc tính skill bao gồm name, description, realm, element, skillType với mastery levels (Mới học, Bậc nhập môn, Thành thạo, Tinh thông, Đại thành, Viên mãn, Cực đại). Loại bỏ location và owner fields theo feedback.' },
      { type: 'feature', text: 'EditNPCModal với comprehensive character editing - Chỉnh sửa đầy đủ thông tin NPC bao gồm basic info (name, gender, age, appearance, location), character attributes (realm, fame, personality, motivation, MBTI), relationship dropdown với predefined options, và skills management với cursor position preservation.' },
      { type: 'feature', text: 'EditPCModal với MBTI personality integration - Chỉnh sửa Player Character với tất cả PC-specific fields bao gồm learned skills, MBTI personality dropdown, experience points, realm progression, và character development attributes với yellow color theme.' },
      { type: 'feature', text: 'EditLocationModal với safety status management - Chỉnh sửa địa điểm với fields: name, parent location, safety status dropdown (tự động update description), climate/environment, notable features, resources/economy, và inhabitants information với green color theme.' },
      { type: 'feature', text: 'Manual Status Deletion System - Thêm X buttons cho mỗi status trong PC và NPC EntityInfoModal. Players có thể manually delete bugged statuses với confirmation dialog, red X buttons xuất hiện on hover, và success notifications. Hỗ trợ cho PC, NPC, và Companion entities.' },
      { type: 'improvement', text: 'Advanced cursor position preservation trong text inputs - Khắc phục cursor jumping issue trong NPC skills field bằng cách implement temporary string fields (skillsText) chỉ convert thành array khi save, maintain cursor position during editing.' },
      { type: 'improvement', text: 'Unified modal state management system - Tích hợp hoàn chỉnh tất cả edit modals vào useModalState hook với proper state cleanup, modal close handlers, và React state management. Enhanced GameScreen integration với save handlers và success notifications.' },
      { type: 'improvement', text: 'Smart edit modal UI/UX design - Mỗi modal có color scheme riêng biệt (amber-skills, blue-NPCs, yellow-PC, green-locations), glass-morphism styling, proper form validation, responsive design, và consistent user experience across all entity types.' },
      { type: 'improvement', text: 'Enhanced EntityInfoModal với edit icons - Thêm pencil edit icons (✏️) trong header của tất cả entity info modals, proper permission checks, color-coded theo entity type, và seamless integration với edit modal system.' },
      { type: 'fix', text: 'Sửa lỗi GameScreen component error "missing modal state variables" - Thêm isEditLocationModalOpen, activeEditLocation, setIsEditLocationModalOpen, setActiveEditLocation vào modal state destructuring trong GameScreen.tsx, khắc phục runtime errors.' },
      { type: 'fix', text: 'Khắc phục cursor jumping trong skills textarea - Enhanced input handling với temporary text state, preserve cursor position during typing, chỉ parse thành array format khi save để tránh input interruption.' },
      { type: 'fix', text: 'Smart status deletion với entity matching - Status deletion system correctly identifies statuses belonging to specific entities, handles PC status ownership properly (matches both entity name và "pc" owner), và prevents accidental deletion của wrong statuses.' },
      { type: 'technical', text: 'Comprehensive edit modal architecture - Created 4 specialized edit modals (EditSkillModal, EditNPCModal, EditPCModal, EditLocationModal) với shared patterns: two-parameter save handlers (original, edited), proper TypeScript interfaces, form validation, responsive design, và error handling.' },
      { type: 'technical', text: 'Advanced modal state integration - Updated useModalState.ts với all Location modal states, enhanced GameScreen.tsx với save handlers và prop passing, updated MemoizedModals.tsx với proper modal integration và component composition.' },
      { type: 'technical', text: 'Status deletion handler implementation - Created handleDeleteStatus với smart filtering logic, success notifications, console logging for debugging, và proper React state management. Integrated across EntityInfoModal → GameScreen → MemoizedModals component chain.' },
      { type: 'technical', text: 'Enhanced form handling và validation - All edit modals implement proper form state management, input validation, save/cancel logic, và data cleanup before saving. Support for both string và array fields với appropriate parsing.' },
    ],
  },
  {
    version: '1.40.0',
    date: '2025-08-06', 
    changes: [
      { type: 'fix', text: 'Khắc phục hoàn toàn lỗi Vietnamese IME composition - Sửa lỗi "thaạo" (diacritics không compose đúng), cursor jumping khi nhấn spacebar, và spacebar không tạo space. Triển khai intelligent IME handling với isComposing state, onCompositionStart/End events, và optimized debounced input system.' },
      { type: 'fix', text: 'Sửa lỗi UnifiedMemoryManager auto-cleanup ngừng hoạt động sau initial cycles - Cải thiện cleanup threshold logic từ simple comparison thành multi-condition triggers: over maxActive limit (45), over cleanup threshold (65), hoặc quá nhiều low-importance memories (>10). Enhanced logging để track cleanup decisions.' },
      { type: 'fix', text: 'Khắc phục lỗi skill merging tạo duplicate skills - Enhanced intelligent skill merging system với space normalization, improved base skill extraction (remove parentheses, level modifiers, colons), smart level-based upgrade logic (Level 0-4), và case-insensitive duplicate detection để tránh "Gou Gou No Mi" vs "Gou Gou no Mi".' },
      { type: 'improvement', text: 'Thêm comprehensive "Hướng Dẫn Thiết Kế NPC Có Cá Tính" vào system instruction - 127 dòng hướng dẫn chi tiết giúp AI tạo NPCs không dễ chinh phục với: nguyên tắc cốt lõi, tránh NPCs "dễ chinh phục", quan hệ xấu với thái độ đối địch, 4 archetypes tính cách mạnh mẽ, ảnh hưởng MBTI, 7 ví dụ thực tế, và quy tắc xử lý xung đột.' },
      { type: 'improvement', text: 'Enhanced skill merging với smart upgrade detection - Triển khai 5-level skill system (0: no modifier, 1: sơ cấp/cơ bản, 2: trung cấp, 3: cao cấp/nâng cao, 4: tối cao) với automatic upgrade replacement (Basic → Advanced), rejection của downgrades, và detailed console logging để tracking merge operations.' },
      { type: 'improvement', text: 'Tối ưu Vietnamese input performance - Loại bỏ useEffect dependency loops trong ActionPanel và MobileInputFooter (customAction, setCustomAction khỏi dependencies), implement useRef-based timeout management, và improved sync logic chỉ khi parent thực sự thay đổi để eliminate keystroke-triggered re-renders.' },
      { type: 'technical', text: 'Advanced IME composition system - onCompositionStart sets isComposing=true để pause debounced updates, onCompositionEnd captures final composed value và resume normal input flow, enhanced input change handling chỉ update khi không đang compose, preventive measures cho Enter key during composition.' },
      { type: 'technical', text: 'Skill base extraction algorithm - Multi-step normalization: space normalization → parentheses removal → level modifier removal → colon content removal → trim, với global regex flags để ensure complete cleaning và accurate base skill comparison.' },
      { type: 'technical', text: 'UnifiedMemoryManager threshold redesign - Chuyển từ simple threshold check sang multi-condition cleanup triggers, enhanced logging với reason tracking, lowImportanceCount display trong debug output, và comprehensive cleanup decision transparency.' },
    ],
  },
  {
    version: '1.39.0',
    date: '2025-08-06',
    changes: [
      { type: 'fix', text: 'Khắc phục lỗi NPC skills bị parse thành PC skills - Enhanced SKILL_LEARNED command với learner parameter để phân biệt kỹ năng học bởi NPC vs PC. Thêm intelligent detection system dựa trên context để tự động phân loại kỹ năng khi thiếu learner parameter.' },
      { type: 'fix', text: 'Loại bỏ console spam từ inventory và entity export debug logs - Xóa bỏ debug logs không cần thiết trong GameScreen playerInventory computation và gameActionHandlers entity export để clean up console output.' },
      { type: 'fix', text: 'Khắc phục lỗi StoryPanel auto-scroll làm gián đoạn việc đọc - Hoàn toàn disable auto-scroll behavior và simplify virtual scrolling system để story panel giữ nguyên vị trí scroll khi có nội dung mới, không còn random scroll up sau khi chọn action.' },
      { type: 'fix', text: 'Sửa lỗi PlayerCharacterSheet crash với "TypeError: t.map is not a function" - Thêm playerInventory property vào MemoizedModalsProps interface để InventoryModal nhận đúng dữ liệu inventory array thay vì undefined.' },
      { type: 'fix', text: 'Khắc phục z-index conflicts trong modal system - Tăng StatusDetailModal từ z-[90] lên z-[110] và QuestDetailModal từ z-[85] lên z-[105] để hiển thị chính xác trên EntityInfoModal (z-[100]).' },
      { type: 'fix', text: 'Sửa lỗi "Cannot read properties of undefined (reading \'toString\')" trong FloatingTimeDisplay - Thêm comprehensive null/undefined checks với safe fallbacks cho tất cả gameTime properties (hour, minute, day, month, year).' },
      { type: 'fix', text: 'Khắc phục input lag nghiêm trọng khi typing trong custom action - Triển khai local state với debounced updates (300ms) cho ActionPanel và MobileInputFooter để ngăn parent re-renders làm chậm input, đồng thời optimize inventory computation với signature-based memoization.' },
      { type: 'improvement', text: 'Enhanced SKILL_LEARNED command documentation - Cập nhật prompt instructions với examples và warnings về việc sử dụng learner parameter bắt buộc cho NPC skills, giúp AI generate tags chính xác hơn.' },
      { type: 'improvement', text: 'Optimized StoryPanel performance - Thay thế complex virtual scrolling với simplified layout để giảm computational overhead và improve scroll behavior stability.' },
      { type: 'improvement', text: 'Enhanced modal layering system - Thiết lập proper z-index hierarchy: Base modals (60-70), EntityInfoModal (100), QuestDetailModal (105), StatusDetailModal (110), EditItemModal (110).' },
      { type: 'technical', text: 'Advanced inventory computation optimization - Thêm itemsSignature-based caching để chỉ recompute inventory khi items thực sự thay đổi, ngăn unnecessary filtering operations block main thread during typing.' },
      { type: 'technical', text: 'Comprehensive input performance optimization - Local state management với useCallback handlers và debounced parent state sync để eliminate keystroke-triggered re-renders across component tree.' },
      { type: 'technical', text: 'Intelligent NPC skill detection system - Context-based parsing để tự động detect skill ownership khi thiếu explicit learner parameter, với fallback logic và comprehensive logging.' },
    ],
  },
  {
    version: '1.38.1',
    date: '2025-08-05',
    changes: [
      { type: 'feature', text: 'Thêm nút "CHỈNH SỬA" cho vật phẩm trong Túi Đồ - Cho phép người chơi chỉnh sửa trực tiếp thông tin vật phẩm (tên, mô tả, số lượng, độ bền, thuộc tính có thể sử dụng/trang bị) thông qua EditItemModal chuyên dụng.' },
      { type: 'feature', text: 'Triển khai EditItemModal với giao diện chỉnh sửa toàn diện - Hỗ trợ chỉnh sửa tất cả thuộc tính vật phẩm bao gồm name, description, quantities/uses, durability, và các boolean properties (usable, equippable, learnable, consumable, equipped).' },
      { type: 'fix', text: 'Khắc phục lỗi z-index layering - EntityInfoModal bị che phủ bởi InventoryModal khi mở từ edit button. Tăng z-index của EntityInfoModal từ z-[80] lên z-[100] để hiển thị đúng thứ tự.' },
      { type: 'fix', text: 'Sửa lỗi nghiêm trọng item editing tạo duplicate thay vì cập nhật - Cải thiện handleSaveEditedItem để track original item name, remove old item khi rename, và update existing item đúng cách thay vì tạo mới.' },
      { type: 'improvement', text: 'Enhanced inventory management với edit capabilities - Edit button màu tím xuất hiện cạnh các nút USE/EQUIP/DISCARD khi select item, tích hợp hoàn toàn với modal system và state management.' },
      { type: 'improvement', text: 'Smart item update system - Xử lý cả trường hợp rename item (xóa item cũ, tạo item mới) và modify properties (update in-place) với proper notification system và modal cleanup.' },
      { type: 'technical', text: 'Comprehensive state management integration - Thêm isEditItemModalOpen, activeEditItem states, modal close handlers, và proper prop passing qua component hierarchy.' },
      { type: 'technical', text: 'Enhanced EditItemModal architecture - Two-parameter save handler (originalItem, editedItem), proper form validation, responsive design với glass-morphism styling, và full TypeScript integration.' },
    ],
  },
  {
    version: '1.38.0',
    date: '2025-08-05',
    changes: [
      { type: 'feature', text: 'Thêm hỗ trợ phút (minutes) cho hệ thống thời gian game - Game time giờ hiển thị chính xác phút (8:45 thay vì 8:00), TIME_ELAPSED command hỗ trợ minutes parameter cho hành động ngắn như mua sắm (15 phút) hoặc di chuyển gần (30-45 phút).' },
      { type: 'feature', text: 'Cải tiến hệ thống Kỹ Năng Khởi Đầu - Tách thành 2 trường riêng biệt (tên kỹ năng và mô tả), thêm nút (+) để thêm nhiều kỹ năng khởi đầu, nút (-) để xóa kỹ năng, layout responsive với grid system.' },
      { type: 'feature', text: 'Thêm lại trường Mục Tiêu (AddGoal) - Textbox mới trong CreateWorld dưới phần Bio, cho phép người chơi định nghĩa mục tiêu và động lực của nhân vật, được lưu vào motivation field của PC entity.' },
      { type: 'feature', text: 'Thêm LORE_PC command tag - Cho phép AI tạo hoặc cập nhật thông tin Player Character trong gameplay, hỗ trợ đầy đủ các thuộc tính như description, personality, motivation, realm, currentExp, và learnedSkills.' },
      { type: 'fix', text: 'Khắc phục lỗi game time ngừng cập nhật - Sửa lỗi TIME_ELAPSED với hours=0 không trigger time update, giờ tất cả TIME_ELAPSED đều được xử lý bình thường kể cả instant actions.' },
      { type: 'fix', text: 'Khắc phục lỗi AddGoal bị AI ghi đè - LORE_PC command giờ merge với existing PC data thay vì overwrite hoàn toàn, bảo tồn motivation field và các thuộc tính quan trọng khác được set trong character creation.' },
      { type: 'fix', text: 'Khắc phục lỗi starting skills không parse vào PC - Thêm debug logging và xử lý backward compatibility, starting skills giờ được thêm vào PC learnedSkills và tạo skill entities trong knownEntities đúng cách.' },
      { type: 'improvement', text: 'Cập nhật system instruction với examples về minutes - AI giờ được hướng dẫn sử dụng minutes cho các hành động ngắn (5-30 phút), giúp thời gian game realistic hơn.' },
      { type: 'improvement', text: 'Enhanced time calculation logic - Thêm minute overflow handling (60 minutes = 1 hour), cải thiện calculateNewTime function để xử lý chính xác thời gian phức tạp.' },
      { type: 'technical', text: 'Backward compatibility cho saved games - Game time structure mới tự động thêm minute: 0 cho các save file cũ, không làm mất dữ liệu người chơi.' },
    ],
  },
  {
    version: '1.37.3',
    date: '2025-08-05',
    changes: [
      { type: 'feature', text: 'Thêm nút Túi đồ (Inventory) cho mobile UI - Triển khai floating action button với ChestIcon màu amber, positioned above choices button, kết nối với cùng InventoryModal như desktop.' },
      { type: 'improvement', text: 'Tối ưu hóa InventoryModal cho mobile devices - Responsive grid layout (4 cols mobile, 6 tablet, 8 desktop), adaptive cell sizes, optimized button spacing và typography cho touch-friendly experience.' },
      { type: 'fix', text: 'Khắc phục lỗi inventory UI không update khi nhặt items từ story - Enhanced inventory filtering với proper useMemo dependency tracking trên knownEntities changes, đảm bảo real-time inventory updates khi ITEM_AQUIRED tags được processed.' },
      { type: 'technical', text: 'Restructured inventory computation system - Moved playerInventory filtering từ inline MemoizedModals props sang entityComputations useMemo với proper knownEntities dependency, improved React rendering performance và state consistency.' },
      { type: 'improvement', text: 'Mobile inventory grid optimizations - Reduced từ 64 slots xuống 48 slots, responsive min-height values (60px-80px), flexible button layouts với wrap support, và improved padding/spacing cho mobile screens.' },
    ],
  },
  {
    version: '1.37.2',
    date: '2025-08-04',
    changes: [
      { type: 'fix', text: 'Khắc phục lỗi Use button không hiển thị cho usable items - Sửa type mismatch giữa InventoryModal và item handlers, đảm bảo usable items hiển thị nút "SỬ DỤNG" chính xác.' },
      { type: 'fix', text: 'Sửa lỗi nghiêm trọng Enhanced RAG Error khi sử dụng items - Thêm defensive programming với null checks cho gameState properties (party, knownEntities, memories) để tránh crashes.' },
      { type: 'fix', text: 'Khắc phục lỗi discarded items vẫn hiển thị trong inventory UI - Triển khai direct handleDiscardItem function và ITEM_DISCARDED tag processor để xóa items ngay lập tức.' },
      { type: 'improvement', text: 'Nâng cấp AdminPanel item creation system - Sửa ITEM_AQUIRED tag generation để sử dụng quoted values cho boolean properties, đảm bảo usable/equippable properties được parse chính xác.' },
      { type: 'improvement', text: 'Simplified item type system - Loại bỏ redundant "consumable" property, chỉ giữ lại "usable" và "equippable" để tránh confusion và duplicate functionality.' },
      { type: 'improvement', text: 'Enhanced item discard system - Direct inventory removal với story log confirmation, không còn phụ thuộc vào AI response để xử lý việc vứt bỏ items.' },
      { type: 'improvement', text: 'Updated AdminPanel UI - Loại bỏ option "Tiêu hao" (Consumable) khỏi dropdown, simplified thành 3 types: Khác, Có thể sử dụng, Có thể trang bị.' },
      { type: 'technical', text: 'Comprehensive gameState null safety - Added optional chaining cho tất cả RAG systems (EnhancedRAG, ReferenceBasedRAG, SmartMemoryGenerator) để handle undefined properties gracefully.' },
      { type: 'technical', text: 'Item handler type safety improvements - Fixed parameter type mismatches giữa InventoryModal (Entity objects) và entity handlers (string names) với proper wrapper functions.' },
      { type: 'technical', text: 'Enhanced tag processing system - ITEM_AQUIRED tag giờ support quoted boolean values và proper attribute parsing cho AdminPanel-generated items.' },
      { type: 'improvement', text: 'Item quantity system modernization - Chuyển đổi từ "uses" sang "quantities" property throughout system: AdminPanel UI, Entity interface, tag processing, inventory display, và AI system instruction.' },
      { type: 'fix', text: 'Items now properly removed when quantities reach 0 - Enhanced ITEM_CONSUMED logic để delete items khi quantities <= 0, support both legacy "uses" và new "quantities" properties.' },
    ],
  },
  {
    version: '1.37.1',
    date: '2025-08-04',
    changes: [
      { type: 'fix', text: 'Khắc phục lỗi quest experience rewards không được tự động cộng vào PC - Triển khai automatic experience parsing và application khi quest hoàn thành qua QUEST_UPDATED và QUEST_OBJECTIVE_COMPLETED tags.' },
      { type: 'fix', text: 'Sửa luyện API empty response error handling - Enhanced error logging với detailed response metadata, specific error diagnosis (content filtering, network issues), và actionable user guidance messages.' },
      { type: 'fix', text: 'Khắc phục forced reflow performance issues gây API blocking - Optimized StoryPanel component với requestAnimationFrame wrapping cho getBoundingClientRect calls, debounced resize handlers, và disabled virtual scrolling during loading states.' },
      { type: 'improvement', text: 'Enhanced quest completion system - Tự động parse experience từ reward strings (hỗ trợ "exp", "kinh nghiệm", "experience" patterns), apply vào PC currentExp, và trigger realm progression checks.' },
      { type: 'improvement', text: 'Improved API error diagnostics - Chi tiết logging bao gồm response metadata, model info, user actions, với specific error condition detection (token limits, content filtering, network issues).' },
      { type: 'improvement', text: 'StoryPanel performance optimizations - RequestAnimationFrame cho DOM measurements, 150ms debounced resize handlers, simplified virtual scrolling cho lists <10 items, và loading state performance guards.' },
      { type: 'technical', text: 'Quest reward processing integration - Modified commandTagProcessor.ts để handle experience rewards trong quest completion flows, với automatic realm progression checking và console logging cho debugging.' },
      { type: 'technical', text: 'DOM performance optimization architecture - Eliminated synchronous getBoundingClientRect calls, implemented proper cleanup patterns cho timeouts, và reduced layout thrashing trong virtual scrolling.' },
    ],
  },
  {
    version: '1.37.0',
    date: '2025-02-02',
    changes: [
      { type: 'fix', text: 'Sửa lỗi SmartMemoryGenerator tạo duplicate memories - Triển khai comprehensive deduplication system với text similarity analysis, keyword extraction (Vietnamese stop-words), semantic similarity checking (>80% threshold), và category-based duplicate detection.' },
      { type: 'fix', text: 'Khắc phục duplicate processing trong memory management architecture - Loại bỏ legacy HistoryManager direct calls từ GameScreen, đảm bảo tất cả memory operations đi qua UnifiedMemoryManager để tránh xung đột configuration.' },
      { type: 'improvement', text: 'Enhanced memory deduplication với multi-layer detection - Text normalization, entity/tag overlap analysis, và real-time duplicate checking trong tất cả memory generation paths (story analysis, relationship tracking, achievement generation).' },
      { type: 'improvement', text: 'Unified Memory Architecture consolidation - Game giờ sử dụng exclusively UnifiedMemoryManager thay vì mixed approach, đảm bảo coordinated cleanup sequence và consistent configuration across tất cả subsystems.' },
      { type: 'improvement', text: 'Optimized UnifiedMemoryManager thresholds - Tăng maxActiveMemories (40→80), maxActiveHistoryEntries (20→50), memoryCleanupThreshold (40→100), historyCompressionThreshold (16→40) để giảm aggressive cleanup và preserve context tốt hơn.' },
      { type: 'improvement', text: 'Smart Memory Generator deduplication enhancements - Centralized duplicate checking với isDuplicateMemory(), deduplicateMemories(), calculateTextSimilarity() methods, và Vietnamese-optimized text analysis với contextual stop-words filtering.' },
      { type: 'technical', text: 'Memory architecture simplification - Removed legacy fallback history compression, unified import structure, và eliminated configuration conflicts giữa HistoryManager và UnifiedMemoryManager systems.' },
      { type: 'technical', text: 'Enhanced duplicate detection algorithms - Jaccard similarity cho text comparison, significant overlap detection cho entities/tags (50% threshold), và category-based validation với importance scoring integration.' },
    ],
  },
  {
    version: '1.36.1',
    date: '2025-01-30',
    changes: [
      { type: 'feature', text: 'Thêm tính năng xuất WorldSetup - cho phép người chơi xuất cấu hình thế giới (worldData và customRules) thành file JSON để sử dụng lại hoặc chia sẻ với người khác.' },
      { type: 'feature', text: 'Tích hợi nút "📤 Xuất WorldSetup" vào cả SidebarNav (mobile) và DesktopHeader menu để dễ dàng truy cập từ trong game.' },
      { type: 'improvement', text: 'File xuất được đặt tên theo format "worldsetup_[tên truyện]_[timestamp].json" với hỗ trợ Unicode đầy đủ cho tên tiếng Việt.' },
      { type: 'improvement', text: 'Loại bỏ các console.log debug từ quest generation và entity export để clean up console output.' },
      { type: 'fix', text: 'Sửa lỗi "Failed to fetch" khi gọi AI API - thường do vấn đề network connectivity hoặc firewall blocking.' },
      { type: 'technical', text: 'WorldSetup export bao gồm worldData, customRules, exportTimestamp và exportVersion để đảm bảo compatibility và traceability.' },
    ],
  },
  {
    version: '1.36.0',
    date: '2025-07-27',
    changes: [
      { type: 'fix', text: 'Sửa lỗi nghiêm trọng khiến Entity Export chạy trùng lặp - 2 instance cùng lúc tạo ra file duplicate. Triển khai comprehensive export locking mechanism với export ID tracking, singleton pattern enforcement, và 5-second cooldown protection.' },
      { type: 'fix', text: 'Khắc phục lỗi Reference-based RAG không hoạt động đúng - Prompt builder vẫn include cả traditional RAG context lẫn reference-based context, phá hỏng mục tiêu tiết kiệm 60-80% tokens. Giờ chỉ sử dụng reference context khi enabled.' },
      { type: 'improvement', text: 'Nâng cấp EntityExportManager với advanced duplicate prevention - Export ID tracking using Set data structure, window-level singleton enforcement, pending exports management, và automatic cleanup system.' },
      { type: 'improvement', text: 'Tối ưu hóa Reference-based RAG system - Loại bỏ traditional entity retrieval khi sử dụng compact context, exclusive context usage, và proper token calculation để đạt được token reduction thực sự.' },
      { type: 'improvement', text: 'Enhanced export locking với export ID integration - gameActionHandlers.ts giờ pass export ID vào shouldExport() và exportEntities() methods, enabling proper duplicate detection và race condition prevention.' },
      { type: 'technical', text: 'Implement export ID tracking system - Unique export IDs với format export_{turn}_{timestamp}_{random}, tracked in pendingExports Set, và automatic cleanup trong finally blocks.' },
      { type: 'technical', text: 'Reference RAG optimization - Entity retrieval từ compact context references thay vì traditional scoring, null intelligentContext khi USE_REFERENCE_RAG enabled, và exclusive prompt assembly logic.' },
      { type: 'technical', text: 'Enhanced EntityExportManager architecture - Window-level singleton pattern, export lock với currentTurn tracking, lastLockTime với cooldown protection, và comprehensive logging system.' },
    ],
  },
  {
    version: '1.35.0',
    date: '2025-07-27',
    changes: [
      { type: 'feature', text: 'Triển khai hệ thống Custom Experience Name hoàn chỉnh - Người chơi có thể định nghĩa tên đơn vị kinh nghiệm trong CreateWorld (ví dụ: Chakra, Linh lực, Ma lực) thay vì "Kinh nghiệm" cố định.' },
      { type: 'feature', text: 'Nâng cấp Realm System với Configurable Tiers - CreateWorld giờ có section "Thiết Lập Hệ Thống Cảnh Giới" với khả năng tự định nghĩa tên cảnh giới và experience requirements cho từng tier.' },
      { type: 'feature', text: 'Dynamic Realm Tier Management - Thêm nút (+) và (-) để tạo/xóa realm tiers, với validation và auto-numbering system để quản lý cảnh giới linh hoạt.' },
      { type: 'feature', text: 'Enhanced Entity Display System - EntityInfoModal và PlayerCharacterSheet giờ hiển thị realm và experience sử dụng custom expName được định nghĩa trong world configuration.' },
      { type: 'improvement', text: 'Backward Compatibility cho Save Files - Hệ thống tự động migrate old save files và settings, đảm bảo game cũ vẫn chạy bình thường với default realm system.' },
      { type: 'improvement', text: 'World Configuration Data Flow - Implement proper prop passing từ GameScreen → MemoizedModals → EntityInfoModal/PlayerCharacterSheet để hiển thị custom expName.' },
      { type: 'fix', text: 'Duplicate Realm Field Bug Fix - Loại bỏ duplicate realm display trong PC EntityInfoModal, giờ chỉ hiển thị "Cảnh giới" một lần cho characters và "Cảnh giới Công Pháp" cho skills.' },
      { type: 'technical', text: 'Extended FormData Interface - Thêm expName (string) và realmTiers (RealmTier[]) fields với full TypeScript support cho realm system configuration.' },
      { type: 'technical', text: 'RealmTier Interface Implementation - Tạo structured interface với id, name, requiredExp fields để quản lý realm progression system.' },
      { type: 'technical', text: 'Enhanced Entity Interface - Thêm currentExp field và realm display logic để support custom experience systems trong game entities.' },
      { type: 'technical', text: 'CreateWorld UI Enhancement - Implement realm management functions với add/remove tier functionality và real-time validation system.' },
      { type: 'technical', text: 'World Data Propagation - Setup complete data flow từ world creation → game state → modal display để đảm bảo custom expName hiển thị đúng ở mọi nơi.' },
    ],
  },
  {
    version: '1.34.0',
    date: '2025-07-27',
    changes: [
      { type: 'feature', text: 'Triển khai hệ thống tự động tạo quest khởi đầu - Mỗi khi tạo thế giới mới, game sẽ tự động tạo một quest exploration để người chơi có mục tiêu ngay từ đầu cuộc phiêu lưu.' },
      { type: 'feature', text: 'Tích hợp QuestGenerator và QuestIntegrator vào quy trình khởi tạo thế giới - Sử dụng AI để tạo quest phù hợp với bối cảnh thế giới, với fallback template nếu AI generation thất bại.' },
      { type: 'improvement', text: 'Cải thiện progress tracking trong world creation - Thêm bước "Đang tạo quest khởi đầu" với progress indicator để người chơi biết hệ thống đang làm gì.' },
      { type: 'improvement', text: 'Enhanced quest integration với automatic quest giver creation - Nếu quest giver chưa tồn tại, hệ thống sẽ tự động tạo NPC quest giver với thông tin phù hợp.' },
      { type: 'improvement', text: 'Automatic initial quest memory creation - Khi quest được tạo, hệ thống tự động tạo memory tương ứng để AI nhớ và tham chiếu trong gameplay.' },
      { type: 'technical', text: 'Enhanced createInitialQuest function với comprehensive error handling - Support cho multiple AI models, fallback system, và detailed logging cho debugging.' },
      { type: 'technical', text: 'Integration với existing quest system architecture - Sử dụng QuestSeed, QuestGenerator.generateQuestsFromSeeds(), và QuestIntegrator.forceIntegrateQuest() để đảm bảo tính nhất quán.' },
      { type: 'technical', text: 'Quest seed configuration optimized cho new worlds - Default exploration type quest với easy difficulty và relevant hooks về khám phá thế giới mới.' },
    ],
  },
];
